<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>828 Weather Direct - Asheville</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f0f2f5; color: #1c1e21; line-height: 1.5; padding: 20px; max-width: 600px; margin: auto; }
        .card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border-left: 5px solid #2e86de; }
        .alert-box { background: #d63031; color: white; padding: 15px; border-radius: 10px; font-weight: bold; margin-bottom: 15px; display: none; }
        .snow-box { background: #74b9ff; color: white; padding: 15px; border-radius: 10px; font-weight: bold; margin-bottom: 15px; display: none; }
        .bin-warning { background: #27ae60; color: white; padding: 15px; border-radius: 10px; font-weight: bold; margin-bottom: 15px; display: none; }
        h1 { color: #2d3436; font-size: 1.8em; margin-bottom: 5px; }
        .metric-label { font-weight: bold; color: #0984e3; text-transform: uppercase; font-size: 0.75em; display: block; }
        .metric-value { font-size: 1.1em; margin-bottom: 12px; }
        .trend-tag { background: #dfe6e9; padding: 3px 6px; border-radius: 4px; font-size: 0.8em; }
    </style>
</head>
<body>

    <h1>828 Weather Direct</h1>
    <p style="color: #636e72; font-size: 0.9em; margin-top:-10px;">Hyper-local Asheville Forecast (Elev: 2,130 ft)</p>

    <div id="nws-alert" class="alert-box"></div>
    <div id="snow-alert" class="snow-box"></div>
    <div id="bin-alert" class="bin-warning"></div>

    <div class="card">
        <span class="metric-label">Human Comfort</span>
        <div class="metric-value" id="comfort-report">Calculating skin-feel...</div>

        <span class="metric-label">Garbage Bins</span>
        <div class="metric-value" id="bin-status">Safe to stay out.</div>
    </div>

    <div class="card">
        <span class="metric-label">Noticeable Trends</span>
        <p><b>Condition:</b> <span class="trend-tag">Notably Dry</span></p>
        <p style="font-size: 0.85em;">February is currently running below average for precipitation in WNC.</p>
    </div>

<script>
        // Use Asheville Grid Coordinates
        const FORECAST_URL = "https://api.weather.gov/gridpoints/GSP/108,110/forecast";
        const ALERTS_URL = "https://api.weather.gov/alerts/active?area=NC";

        async function updateWeather() {
            try {
                // NWS requires a User-Agent header to identify the requester
                const headers = { "User-Agent": "828WeatherDirectApp (your-email@example.com)" };

                // 1. Fetch Forecast Data
                const fReq = await fetch(FORECAST_URL, { headers });
                if (!fReq.ok) throw new Error("Forecast fetch failed");
                
                const fData = await fReq.json();
                const periods = fData.properties.periods;
                const now = periods[0];

                // FIX: DEW POINT DATA PARSING
                let dewPointValue = 0;
                if (now.dewpoint && typeof now.dewpoint === 'object') {
                    dewPointValue = now.dewpoint.value;
                } else if (typeof now.dewpoint === 'number') {
                    dewPointValue = now.dewpoint;
                }

                const comfortDiv = document.getElementById('comfort-report');
                if (now.temperature >= 65) {
                    const dpF = (dewPointValue * 9/5) + 32;
                    if (dpF < 55) comfortDiv.innerText = "üß§ Crisp & Dry: Great hair day!";
                    else if (dpF <= 60) comfortDiv.innerText = "üëå Pleasant: Standard mountain comfort.";
                    else if (dpF <= 65) comfortDiv.innerText = "üíß Sticky: You'll feel the humidity.";
                    else comfortDiv.innerText = "üå°Ô∏è Oppressive: Air you can wear.";
                } else {
                    comfortDiv.innerText = "Neutral (Temp below 65¬∞F)";
                }

                // BIN ALERT LOGIC (Wind Gusts >= 25mph)
                const windNumbers = now.windSpeed.match(/\d+/g);
                const maxWind = windNumbers ? Math.max(...windNumbers.map(Number)) : 0;
                if (maxWind >= 25) {
                    const binDiv = document.getElementById('bin-alert');
                    binDiv.innerHTML = `üö® BIN ALERT: Wind gusts forecasted at ${maxWind} mph. Secure your bins!`;
                    binDiv.style.display = 'block';
                    document.getElementById('bin-status').innerText = "BRING THEM IN!";
                }

                // SNOW WATCH LOGIC (48-Hour Rule)
                const snowPeriods = periods.filter(p => p.detailedForecast.toLowerCase().includes("snow"));
                if (snowPeriods.length > 0) {
                    const snowDiv = document.getElementById('snow-alert');
                    const firstSnow = snowPeriods[0];
                    const startTime = new Date(firstSnow.startTime);
                    const hoursUntilSnow = (startTime - new Date()) / 36e5;
                    let snowMsg = "‚ùÑÔ∏è SNOW WATCH: Snow is in the forecast.";
                    if (hoursUntilSnow <= 48) {
                        snowMsg += " Accumulations likely within 48 hours. Check local totals.";
                    } else {
                        snowMsg += " (Amounts hidden until 48hr window).";
                    }
                    snowDiv.innerHTML = snowMsg + "<br><small>Trend: Monitoring snowfall potential.</small>";
                    snowDiv.style.display = 'block';
                }

                // 2. NWS ALERTS FOR BUNCOMBE
                const aReq = await fetch(ALERTS_URL, { headers });
                const aData = await aReq.json();
                const buncombeAlerts = aData.features.filter(a => 
                    a.properties.areaDesc && a.properties.areaDesc.includes("Buncombe")
                );
                if (buncombeAlerts.length > 0) {
                    const alertDiv = document.getElementById('nws-alert');
                    const eventName = buncombeAlerts[0].properties.event;
                    const isElevSpecific = buncombeAlerts[0].properties.description.toLowerCase().includes("elevation");
                    alertDiv.innerText = `‚ö†Ô∏è NWS ALERT: ${eventName}${isElevSpecific ? " (Elevation Specific)" : ""}`;
                    alertDiv.style.display = 'block';
                }

            } catch (e) { 
                console.error("828 Weather Direct Error:", e);
                document.getElementById('comfort-report').innerText = "NWS Data currently restricted. Checking connection...";
            }
        }

        updateWeather();
    </script>
</body>
</html>

